

file:  schemaupgrades.rst
------------------------------------------------------------------------------------

Removed this Line from Intro

- :ref:`Non-Blocking Operation <nbo>` (NBO)

Removed this Section

----------------------------
Non-Blocking Operation
----------------------------
.. _`nbo`:
.. index::
   pair: Galera Cluster 4.x; Non-Blocking Operation
.. index::
   pair: Online Schema Upgrades; Non-Blocking Operation

When you want to maintain high-availability while altering, analyzing or optimizing tables and don't mind the particular limitations, use the :term:`Non-Blocking Operation` method.

Under the :term:`Total Order Isolation` method, when DDL statements replicate, the nodes block almost all updates and with some statements this can go on for a particularly long time.  In the Non-Blocking Operation method, the node applies special table locks called metadata locks on all nodes, in order to ensure consistency.  The nodes all execute the DDL statements, using a separate applier thread.  Then, once the statement is applied, all nodes simultaneously release the locks.

.. code-block:: mysql

   SET SESSION wsrep_OSU_method='NBO';

Given its :ref:`limitations <nbo-limitations>`, the recommended method in updating the schema with a Non-Blocking Operation is to enable it at a session level, run the command, and then reset the Online Schema Upgrade method back to ``TOI`` or ``RSU``.
   
DDL statements that support Non-Blocking Operation:

- ``ALTER TABLE table_name LOCK = {SHARED|EXCLUSIVE}, alter_specification``
- ``ALTER TABLE table_name LOCK = {SHARED|EXCLUSIVE} PARTITION``
- ``CREATE INDEX ... LOCK = {SHARED|EXCLUSIVE}``
- ``DROP INDEX``
- ``ANALYZE TABLE``
- ``OPTIMIZE TABLE`` 

.. note:: For partition-management operations, no comma is used after ``LOCK = {SHARED|EXCLUSIVE}``.

DDL statements that do not support Non-Blocking Operation:

- ``ALTER TABLE LOCK = {DEFAULT|NONE}``, including ``ALTER`` statements without the ``LOCK`` clause, as such statements default to the ``DEFAULT`` lock.
- ``CREATE TABLE``, ``RENAME``, ``DROP``, and ``REPAIR``.

Issuing unsupported operations while using the Non-Blocking Operation method results in an error code.  For example,

.. code-block:: mysql

   SET SESSION wsrep_OSU_method='NBO';
   CREATE TABLE table_name (
        id INT,
	title VARCHAR(255)) ENGINE=InnoDB;

   Error 42000: wsrep_OSU_method NBO not supported for query